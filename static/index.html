<!DOCTYPE html>
<html lang="de">

<head>

    <title>Bot-Chat</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
    <style>
        body {
            background: #eef2f6;
        }

        .chat-card {
            min-height: 300px;
        }

        #chatModal .modal-header {
            background-color: #fff;
            border-bottom: none;
        }

        #chatModal .modal-body {
            padding-top: 0;
        }

        .chat-messages {
            flex: 1 1 auto;
            overflow-y: auto;
            padding: 0;
            margin-bottom: 1rem;
        }

        .chat-bubble {
            max-width: 75%;
            margin-bottom: 12px;
            padding: 10px 16px;
            border-radius: 0.5rem;
            font-size: 1.05rem;
            word-break: break-word;
            line-height: 1.4;
            box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.03);
        }

        .from-user {
            margin-left: auto;
            background: #e2f7e1;
            color: #234a1d;
        }

        .from-bot {
            margin-right: auto;
            background: #f0f2f5;
            color: #223;
        }

        .btn-send {
            background: #e9ecef;
            border: solid 1px #dee2e6;
            border-left: 0;
            padding: 0.5rem 1.25rem;
        }

        .btn-send:hover {
            border: solid 1px #dee2e6;
            border-left: 0;
        }

        /* on .btn-send:hover rotate the svg in it by 45 degree */
        .btn-send:hover svg {
            transform: rotate(45deg);
            transition: transform 0.2s ease-in-out;
        }

        /* hide scrollbar */
        .chat-messages::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>

<body>
    <header>
        <div class="d-flex justify-content-end p-2">
            <!-- Button trigger modal -->
            <button type="button" class="btn btn-link" data-bs-toggle="modal" data-bs-target="#chatModal">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
                    class="bi bi-question-circle-fill" viewBox="0 0 16 16">
                    <path
                        d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.496 6.033h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286a.237.237 0 0 0 .241.247m2.325 6.443c.61 0 1.029-.394 1.029-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94 0 .533.425.927 1.01.927z" />
                </svg>
            </button>
        </div>
    </header>
    <main>
        <div class="container py-4">
            <!-- Modal -->
            <div class="modal fade" id="chatModal" tabindex="-1" aria-labelledby="chatModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header ">
                            <!-- <h1 class="modal-title fs-5" id="chatModalLabel">Fragen rund ums Schlaflabor</h1> -->
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="chat-card">
                                <div id="chat-messages" class="chat-messages">
                                    <!-- Nachrichten erscheinen hier -->
                                </div>

                            </div>
                        </div>
                        <div class="modal-footer">
                            <form id="chat-form" class="w-100 chat-footer mt-2">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="user-input" placeholder="Deine Frage..."
                                        autocomplete="off" required>
                                    <button class="btn btn-send" type="submit" title="Senden">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="#93908f"
                                            class="bi bi-send-fill" viewBox="0 0 16 16">
                                            <path
                                                d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471z" />
                                        </svg>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const messages = document.getElementById("chat-messages");
        const chatForm = document.getElementById("chat-form");
        const userInput = document.getElementById("user-input");

        // Dummy Begrüßung vom Bot
        function botWelcome() {
            appendMessage("Hallo! Stelle mir gern deine Fragen rund ums Schlaflabor.", "from-bot");
        }
        botWelcome();

        function appendMessage(text, sender) {
            const bubble = document.createElement("div");
            bubble.className = `chat-bubble ${sender}`;
            bubble.innerHTML = text;
            messages.appendChild(bubble);
            messages.scrollTop = messages.scrollHeight;
        }

        chatForm.onsubmit = async function (e) {
            e.preventDefault();
            const question = userInput.value.trim();
            if (!question) return;
            appendMessage(question, "from-user");
            userInput.value = "";
            appendMessage('<span class="text-muted">Bitte warten...</span>', "from-bot");
            try {
                const res = await fetch("/chatbot", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ question }),
                });
                const data = await res.json();
                // Entferne "Bitte warten..."
                messages.removeChild(messages.lastElementChild);
                appendMessage(data.answer, "from-bot");
            } catch {
                messages.removeChild(messages.lastElementChild);
                appendMessage("Fehler: Es konnte keine Antwort abgerufen werden.", "from-bot");
            }
        };
    </script>
</body>

</html>